?start: define

define:"(" definition predicates action+ ")"

definition : "define" "(" "domain" string ")"

predicates : "(" ":predicates" predicate+ ")"

action : "(" ":action" string parameters precondition effect ")"

parameters : ":parameters" "(" var+ ")"

precondition : ":precondition" "(" "and" predicate+ ")"

effect : ":effect" "(" "and" (n_predicate|predicate)+ ")"

n_predicate : "(" "not" predicate ")"

predicate : "(" string var* ")"

var : "?" string

string :  /\w+(-\w+)*/



%import common.WS
%ignore WS
<require-key> ::= See Section 15
    <types-def> ::= (:types <typed list (name)>)
    <constants-def> ::= (:constants <typed list (name)>)
    <domain-vars-def> ::= (:domain-variables
    <typed list(domain-var-declaration)>)
    <predicates-def> ::= (:predicates <atomic formula skeleton>+)
    <atomic formula skeleton>
    ::= (<predicate> <typed list (variable)>)
    <predicate> ::= <name>
    <variable> ::= ?<name>
    <timeless-def> ::= (:timeless <literal (name)>+)
    <structure-def> ::= <action-def>
    <structure-def> ::=:domainaxioms <axiom-def>
    <structure-def> ::=:actionexpansions <method-def>
(define
    (domain construction)
    (:extends building)
    (:requirements :strips :typing)
    (:types
        site material - object
        bricks cables windows - material
    )
    (:constants mainsite - site)

    ;(:domain-variables ) ;deprecated

    (:predicates
        (walls-built ?s - site)
        (windows-fitted ?s - site)
        (foundations-set ?s - site)
        (cables-installed ?s - site)
        (site-built ?s - site)
        (on-site ?m - material ?s - site)
        (material-used ?m - material)
    )

    (:timeless (foundations-set mainsite))

    ;(:safety
        ;(forall
        ;    (?s - site) (walls-built ?s)))
        ;deprecated

    (:action BUILD-WALL
        :parameters (?s - site ?b - bricks)
        :precondition (and
            (on-site ?b ?s)
            (foundations-set ?s)
            (not (walls-built ?s))
            (not (material-used ?b))
        )
        :effect (and
            (walls-built ?s)
            (material-used ?b)
        )
        ; :expansion ;deprecated
    )

    (:axiom
        :vars (?s - site)
        :context (and
            (walls-built ?s)
            (windows-fitted ?s)
            (cables-installed ?s)
        )
        :implies (site-built ?s)
    )

    ;Actions omitted for brevity
)
